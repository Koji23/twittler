<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Jordan's Twittler</title>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <main class="clearfix">
      <h1>Twittler</h1>
      <section>
        <h2 class="streamTitle"></h2>
        <button class="refreshHome">Refresh Home</button>
        <ul></ul>
      </section>
    </main>
    <script>

      $(document).ready(function(){
        var $feed = $('section').find('ul');
        var nextIndex = streams.home.length;
        var index;

        function formatTime(time){
          var hour = time.getHours();
          var min = time.getMinutes();
          var sec = time.getSeconds();
          var ampm = "AM";
          if(hour > 12) ampm = "PM";
          if(ampm === "PM") hour -= 12;
          if(min < 10) min = "0" + String(min);
          if(sec < 10) sec = "0" + String(sec);
          return String(hour) + ":" + min + ":" + sec + " " + ampm ;
        }
        function makeTweet(obj){
          var $tweet = $('<li class="clearfix"></li>');
          var $imgContainer = $('<div class="img"></div>');
          var $textContainer = $('<div class="txt"></div>');
          var $user = $('<h3></h3>').text('@' + obj.user);
          var $timeStamp = $('<i></i>').text(formatTime(obj.created_at));
          var $message = $('<p></p>').text(obj.message);
          $tweet.attr('data-name', obj.user);
          $textContainer.append($user).append($timeStamp).append($message);
          $tweet.append($imgContainer).append($textContainer);
          return $tweet;
        }
        function addNew(){
          for(index = nextIndex; index <= streams.home.length-1; index++){
            var $newTweet = makeTweet(streams.home[index]);
            $newTweet.prependTo($feed);
          }
        }
        function homeStream(){
          index = streams.home.length - 1;
          $feed.html("");
          while(index >= 0){   
            var $tweet = makeTweet(streams.home[index]);
            $tweet.appendTo($feed);
            index--;
          }
        }
        function userStream(){
          var userName = $(this).text().slice(1);
          index = streams.users[userName].length - 1;
          $feed.html("");
          while(index >= 0){
            var $tweet = makeTweet(streams.users[userName][index]);
            $tweet.appendTo($feed);
            index--;
          }
          
        }
        //Execution
        homeStream();
        $('section').on('click', '.refreshHome', addNew);
        $('section').on('click', 'h3', userStream);
        //setInterval(addNew, 3000);
      }); 
      console.log(streams.home[0]);
    </script>  
  </body>
</html>
